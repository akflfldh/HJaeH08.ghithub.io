---
title: "Switch문과 함수테이블 비교"

categories: -C++

toc: true
toc_sticky: true
layout: post
date: 2024-06-01
last_modified_at: 2024-06-01
---



**네트워크 패킷설계에대한 공부를 하고있다**
\
**패킷을 식별하여 각각 알맞게 처리하도록 하는 코드를 작성하기위해  if else 문 또는 switch문을 생각을했었다**
\
\
**그런데 패캣의 종류가 많아진다면 if else문 switch문에서 조건판정을 해야하는 경우가 많아지니 성능저하가 있을것이다라고 생각했다. 그리고 더 효율적으로 수행할수있는 방법이 있을것이라고 생각했다.**
\
\
**그래서 곰곰히 생각해서 도출한결과가 바로 '테이블'을 구성하는것이였다**
\
\
**테이블에는 함수주소들을 넣고 패킷의 id(부호없는정수)로 인덱싱하여 상수시간O(1)에 필요한 함수를 호출하는것이다**
\
\
**이렇게되면 if,switch문에서 생길수있는 cpu의 분기예측실패와 같은 성능저하요소를 해결할수있을것이라고 생각했다.**
\
\
**하지만 추가적으로 chatGpt에 질문을 한결과 컴파일러가 점프테이블와 같은 최적화를 수행한다고 답변을 해주었다(점프테이블에대해서는 정확히 알아보지않았으나, 거의 상수시간O(1)복잡도를 가지게된다라고한다)**
\
\
\
**따라서 직접 간단한 코드를 작성해서 프로파일링하여 cpu주기를 얼마나 소비하는지로 확인하고자했다.**
\
\
**함수테이블**\
![switch함수테이블코드20240601](https://github.com/akflfldh/akflfldh.github.io/assets/52809733/4e23409f-96ae-4d56-b945-18f2b2abfa67)
\
\
**각각의 함수들은 단순히 0~284까지번호들중 하나를리턴한다**
\
\
**swtich**\
![switch컴파일러코드20240601](https://github.com/akflfldh/akflfldh.github.io/assets/52809733/643e04df-e461-4188-bc0a-1bf19e179510)
\
\
\
**switch문에서는  output에 각각의 번호를 저장하고빠져나온다.(정확히는함수를호출했어야했다,코드를 다시작성하기에는 시간이 걸려서 수정하지않았다.또한 결론적으로는 두 결과차이가 없엇기에 다시 코드를 수정하지않았다)**
\
\
**결과**
\
\
**함수테이블**
![switch함수테이블프로파일링결과20240601](https://github.com/akflfldh/akflfldh.github.io/assets/52809733/fcf88ecc-d6a0-4e66-a8a8-b60980b62f72)
\
\
\
\
**switch**
![switch컴파일러프로파일링결과20240601](https://github.com/akflfldh/akflfldh.github.io/assets/52809733/555b1e03-ac30-4ba8-a502-162dd8791830)
\
\
**외부코드 cpu주기를 뺴고 본결과 차이가 없다는것을 알수있었다**
\
\
\
**따라서 더편리하게코드를작성할수있고 가독성이 좋을수있는 switch문을 사용하는것이 좋겠다**
\
\